---
title: Image Editing & Variations
description: Editing existing images and creating variations.
---

import { Aside, Tabs, TabItem } from '@astrojs/starlight/components';

# Image Editing & Variations

UPP supports image editing (inpainting), variations, and upscaling for models that support these features.

## Checking Capabilities

Always check capabilities before using optional features:

```typescript
const imageGen = image({ model: openai('dall-e-3') });

console.log(imageGen.capabilities);
// {
//   generate: true,
//   edit: true,
//   vary: true,
//   upscale: false,
//   streaming: false,
//   ...
// }
```

## Image Editing (Inpainting)

Edit specific regions of an image using a mask:

```typescript
if (dalle.capabilities.edit && dalle.edit) {
  const edited = await dalle.edit({
    image: await Image.fromPath('./photo.png'),
    mask: await Image.fromPath('./mask.png'), // White = edit area
    prompt: 'Replace the sky with a starry night',
  });

  await Bun.write('edited.png', edited.images[0].image.toBytes());
}
```

### ImageEditInput

```typescript
interface ImageEditInput {
  /** Base image to edit */
  image: Image;

  /** Mask indicating edit region (white = edit area) */
  mask?: Image;

  /** Edit instruction */
  prompt: string;

  /** Negative prompt */
  negativePrompt?: string;
}
```

<Aside type="tip" title="Creating Masks">
Masks should be the same size as the input image. White pixels indicate areas to edit, black pixels are preserved.
</Aside>

## Image Variations

Create variations of an existing image:

```typescript
if (dalle.capabilities.vary && dalle.vary) {
  const variations = await dalle.vary({
    image: await Image.fromPath('./original.png'),
    count: 3,
    strength: 0.7, // 0 = identical, 1 = completely different
  });

  for (let i = 0; i < variations.images.length; i++) {
    await Bun.write(`variation-${i}.png`, variations.images[i].image.toBytes());
  }
}
```

### ImageVaryInput

```typescript
interface ImageVaryInput {
  /** Source image for variations */
  image: Image;

  /** Number of variations to generate */
  count?: number;

  /** Variation strength (0-1, higher = more different) */
  strength?: number;
}
```

## Image Upscaling

Increase image resolution:

```typescript
if (imageGen.capabilities.upscale && imageGen.upscale) {
  const upscaled = await imageGen.upscale({
    image: await Image.fromPath('./low-res.png'),
    scale: 4, // 2x or 4x
  });

  await Bun.write('high-res.png', upscaled.images[0].image.toBytes());
}
```

### ImageUpscaleInput

```typescript
interface ImageUpscaleInput {
  /** Image to upscale */
  image: Image;

  /** Target scale factor */
  scale?: 2 | 4;
}
```

## Provider Support

| Feature | OpenAI | Stability | Google |
|---------|--------|-----------|--------|
| Edit (Inpainting) | DALL-E 2 | SDXL | - |
| Variations | DALL-E 2 | SDXL | - |
| Upscale | - | Yes | - |
| Outpaint | - | SDXL | - |

## Practical Examples

<Tabs>
  <TabItem label="Background Removal">
```typescript
// Use edit to replace background
const result = await dalle.edit({
  image: await Image.fromPath('./product.png'),
  mask: await Image.fromPath('./background-mask.png'),
  prompt: 'Pure white background, product photography',
});
```
  </TabItem>
  <TabItem label="Style Transfer">
```typescript
// Create variations with different strength
const styles = [0.3, 0.5, 0.7, 0.9];

for (const strength of styles) {
  const result = await imageGen.vary({
    image: await Image.fromPath('./photo.png'),
    count: 1,
    strength,
  });

  await Bun.write(
    `style-${strength}.png`,
    result.images[0].image.toBytes()
  );
}
```
  </TabItem>
  <TabItem label="Batch Upscaling">
```typescript
const files = await glob('./low-res/*.png');

for (const file of files) {
  const result = await imageGen.upscale({
    image: await Image.fromPath(file),
    scale: 4,
  });

  const outPath = file.replace('low-res', 'high-res');
  await Bun.write(outPath, result.images[0].image.toBytes());
}
```
  </TabItem>
</Tabs>

## Error Handling

```typescript
try {
  const result = await dalle.edit({
    image: await Image.fromPath('./photo.png'),
    mask: await Image.fromPath('./mask.png'),
    prompt: 'Add a rainbow',
  });
} catch (error) {
  if (error instanceof UPPError) {
    switch (error.code) {
      case 'INVALID_REQUEST':
        console.log('Invalid image format or size');
        break;
      case 'CONTENT_FILTERED':
        console.log('Edit was blocked by content policy');
        break;
      default:
        throw error;
    }
  }
}
```
