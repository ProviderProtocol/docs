---
title: Image Generation
description: Generating images from text prompts.
---

import { Tabs, TabItem, Aside } from '@astrojs/starlight/components';

# Image Generation

Generate images from text prompts using various AI models.

## Basic Generation

```typescript
import { image } from '@providerprotocol/ai';
import { openai } from '@providerprotocol/ai/openai';

const dalle = image({
  model: openai('dall-e-3'),
  params: { size: '1024x1024', quality: 'hd' },
});

const result = await dalle.generate('A sunset over mountains, oil painting style');

// Save the image
await Bun.write('sunset.png', result.images[0].image.toBytes());
```

## Advanced Generation

Use detailed prompts with negative prompts and seeds:

```typescript
import { stability } from '@providerprotocol/ai/stability';

const sd = image({
  model: stability('stable-diffusion-xl-1024-v1-0'),
  params: {
    steps: 30,
    cfg_scale: 7,
    samples: 4,
  },
});

const result = await sd.generate({
  prompt: 'A photorealistic cat sitting on a windowsill, golden hour lighting',
  negativePrompt: 'cartoon, drawing, illustration, low quality, blurry',
  seed: 12345,
});

console.log(result.images.length);  // 4
console.log(result.metadata?.seed); // 12345

// Save all images
for (let i = 0; i < result.images.length; i++) {
  await Bun.write(`cat-${i}.png`, result.images[i].image.toBytes());
}
```

## Streaming Progress

Some models support streaming progress updates:

```typescript
if (sd.capabilities.streaming && sd.stream) {
  const stream = sd.stream({
    prompt: 'A cyberpunk cityscape at night, neon lights, rain',
  });

  for await (const event of stream) {
    switch (event.type) {
      case 'progress':
        console.log(`${event.percent}% - ${event.stage}`);
        break;
      case 'preview':
        // Display low-res preview
        displayPreview(event.image, event.index);
        break;
      case 'complete':
        console.log(`Image ${event.index} complete`);
        break;
    }
  }

  const finalResult = await stream.result;
  console.log(`Generated ${finalResult.images.length} images`);
}
```

## Provider Comparison

<Tabs>
  <TabItem label="DALL-E 3">
```typescript
const dalle = image({
  model: openai('dall-e-3'),
  params: {
    size: '1024x1024',  // or '1792x1024', '1024x1792'
    quality: 'hd',       // 'standard' or 'hd'
    style: 'vivid',      // 'vivid' or 'natural'
  },
});

const result = await dalle.generate('A serene Japanese garden');

// DALL-E 3 often revises prompts for better results
console.log(result.metadata?.revisedPrompt);
```
  </TabItem>
  <TabItem label="Stable Diffusion">
```typescript
const sd = image({
  model: stability('stable-diffusion-xl-1024-v1-0'),
  params: {
    steps: 30,
    cfg_scale: 7,
    samples: 4,
    style_preset: 'photographic',
  },
});

const result = await sd.generate({
  prompt: 'A serene Japanese garden',
  negativePrompt: 'ugly, blurry, low quality',
  seed: 42,
});
```
  </TabItem>
  <TabItem label="Imagen">
```typescript
const imagen = image({
  model: google('imagen-3.0-generate-001'),
  params: {
    sampleCount: 4,
    aspectRatio: '16:9',
  },
});

const result = await imagen.generate('A serene Japanese garden');
```
  </TabItem>
</Tabs>

## Multiple Images

Generate multiple images in a single request:

```typescript
const sd = image({
  model: stability('stable-diffusion-xl-1024-v1-0'),
  params: { samples: 4 },
});

const result = await sd.generate('Abstract art, vibrant colors');

for (const [index, generated] of result.images.entries()) {
  await Bun.write(`art-${index}.png`, generated.image.toBytes());
}
```

<Aside type="note">
The maximum number of images depends on the model. Check `capabilities.maxImages` for the limit.
</Aside>

## Working with Generated Images

```typescript
const result = await dalle.generate('A landscape');
const generated = result.images[0];

// Get raw bytes
const bytes = generated.image.toBytes();

// Get base64
const base64 = generated.image.toBase64();

// Get data URL for web display
const dataUrl = generated.image.toDataUrl();

// Check dimensions
console.log(generated.image.width, generated.image.height);
console.log(generated.image.mimeType); // 'image/png'
```

## Error Handling

```typescript
try {
  const result = await dalle.generate('A portrait');
} catch (error) {
  if (error instanceof UPPError) {
    if (error.code === 'CONTENT_FILTERED') {
      console.log('Image was filtered for content policy');
    } else if (error.code === 'RATE_LIMITED') {
      console.log('Rate limited, try again later');
    }
  }
}
```
