---
title: "Variable: h3"
---

[**@providerprotocol/ai**](../../index.md)

***

[@providerprotocol/ai](./index.md) / [proxy](../index.md) / h3

# Variable: h3

> `const` **h3**: `object`

Defined in: [src/providers/proxy/server/h3.ts:288](https://github.com/ProviderProtocol/ai/blob/6119c5b59e26af41fa847efb47d9abf792ee3fb5/src/providers/proxy/server/h3.ts#L288)

H3/Nitro/Nuxt adapter utilities.

## Type Declaration

### createImageSSEStream()

> **createImageSSEStream**: (`stream`) => `ReadableStream`\<`Uint8Array`\<`ArrayBufferLike`\>\>

Create a ReadableStream for image SSE data.

#### Parameters

##### stream

`ImageStreamLike`

The ImageStreamResult or ImageProviderStreamResult from image().stream()

#### Returns

`ReadableStream`\<`Uint8Array`\<`ArrayBufferLike`\>\>

A ReadableStream of SSE data

### createSSEStream()

> **createSSEStream**: (`stream`) => `ReadableStream`\<`Uint8Array`\<`ArrayBufferLike`\>\>

Create a ReadableStream for H3's sendStream utility.

Use this with H3's sendStream for better integration:
```typescript
import { sendStream } from 'h3';
return sendStream(event, h3Adapter.createSSEStream(stream));
```

#### Parameters

##### stream

[`StreamResult`](../../core/interfaces/streamresult.md)

The StreamResult from instance.stream()

#### Returns

`ReadableStream`\<`Uint8Array`\<`ArrayBufferLike`\>\>

A ReadableStream of SSE data

### sendEmbeddingJSON()

> **sendEmbeddingJSON**: (`result`, `event`) => `unknown`

Send an EmbeddingResult as JSON response.

#### Parameters

##### result

[`EmbeddingResult`](../../core/interfaces/embeddingresult.md)

The embedding result

##### event

`H3Event`

H3 event object

#### Returns

`unknown`

Serialized result data

### sendError()

> **sendError**: (`message`, `status`, `event`) => `object`

Send an error response.

#### Parameters

##### message

`string`

Error message

##### status

`number`

HTTP status code

##### event

`H3Event`

H3 event object

#### Returns

`object`

Error object for H3 to serialize

##### error

> **error**: `string`

##### statusCode

> **statusCode**: `number`

### sendImageJSON()

> **sendImageJSON**: (`result`, `event`) => `unknown`

Send an ImageResult as JSON response.

#### Parameters

##### result

[`ImageResult`](../../core/interfaces/imageresult.md)

The image result

##### event

`H3Event`

H3 event object

#### Returns

`unknown`

Serialized image result data

### sendJSON()

> **sendJSON**: (`turn`, `event`) => `unknown`

Send a Turn as JSON response.

#### Parameters

##### turn

[`Turn`](../../core/interfaces/turn.md)

The completed inference turn

##### event

`H3Event`

H3 event object

#### Returns

`unknown`

Serialized turn data

#### Example

```typescript
const turn = await instance.generate(messages);
return h3Adapter.sendJSON(turn, event);
```

### streamImageSSE()

> **streamImageSSE**: (`stream`, `event`) => `void`

Stream an ImageStreamResult as Server-Sent Events.

#### Parameters

##### stream

`ImageStreamLike`

The ImageStreamResult or ImageProviderStreamResult from image().stream()

##### event

`H3Event`

H3 event object

#### Returns

`void`

### streamSSE()

> **streamSSE**: (`stream`, `event`) => `void`

Stream a StreamResult as Server-Sent Events.

#### Parameters

##### stream

[`StreamResult`](../../core/interfaces/streamresult.md)

The StreamResult from instance.stream()

##### event

`H3Event`

H3 event object

#### Returns

`void`

#### Example

```typescript
const stream = instance.stream(messages);
return h3Adapter.streamSSE(stream, event);
```

## Examples

```typescript
// Nuxt server route: server/api/ai.post.ts
import { llm } from '@providerprotocol/ai';
import { anthropic } from '@providerprotocol/ai/anthropic';
import { parseBody } from '@providerprotocol/ai/proxy';
import { h3 as h3Adapter } from '@providerprotocol/ai/proxy/server';

export default defineEventHandler(async (event) => {
  const body = await readBody(event);
  const { messages, system, params } = parseBody(body);
  const instance = llm({ model: anthropic('claude-sonnet-4-20250514'), system });

  const wantsStream = getHeader(event, 'accept')?.includes('text/event-stream');
  if (wantsStream) {
    return h3Adapter.streamSSE(instance.stream(messages), event);
  } else {
    const turn = await instance.generate(messages);
    return h3Adapter.sendJSON(turn, event);
  }
});
```

```typescript
// server/api/ai.post.ts
import { llm } from '@providerprotocol/ai';
import { anthropic } from '@providerprotocol/ai/anthropic';
import { ExponentialBackoff, RoundRobinKeys } from '@providerprotocol/ai/http';
import { parseBody } from '@providerprotocol/ai/proxy';
import { h3 as h3Adapter } from '@providerprotocol/ai/proxy/server';

// Server manages AI provider keys - users never see them
const claude = llm({
  model: anthropic('claude-sonnet-4-20250514'),
  config: {
    apiKey: new RoundRobinKeys([
      process.env.ANTHROPIC_KEY_1!,
      process.env.ANTHROPIC_KEY_2!,
    ]),
    retryStrategy: new ExponentialBackoff({ maxAttempts: 3 }),
  },
});

export default defineEventHandler(async (event) => {
  // Authenticate with your platform credentials
  const token = getHeader(event, 'authorization')?.replace('Bearer ', '');
  const user = await validatePlatformToken(token);
  if (!user) {
    throw createError({ statusCode: 401, message: 'Unauthorized' });
  }

  // Track usage per user
  // await trackUsage(user.id);

  const body = await readBody(event);
  const { messages, system, params } = parseBody(body);

  if (params?.stream) {
    return h3Adapter.streamSSE(claude.stream(messages, { system }), event);
  }
  const turn = await claude.generate(messages, { system });
  return h3Adapter.sendJSON(turn, event);
});
```
