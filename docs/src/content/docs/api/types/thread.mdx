---
title: Thread
description: Utility class for managing conversation history.
---

import { Aside, Badge } from '@astrojs/starlight/components';

# Thread

<Badge text="UPP-1.1 Compliant" variant="success" />

A utility class for managing LLM conversation history.

<Aside type="note" title="Specification">
  Implements the [UPP-1.1 Thread](/spec/llm/interface) specification.
</Aside>

## Import

```typescript
import { Thread } from '@providerprotocol/ai';
```

## Class Definition

```typescript
class Thread {
  /** Unique thread identifier */
  readonly id: string;

  /** Get all messages (readonly) */
  get messages(): readonly Message[];

  /** Number of messages */
  get length(): number;

  /** Append a Turn's messages */
  append(turn: Turn): this;

  /** Push individual messages */
  push(...messages: Message[]): this;

  /** Add a user message */
  user(content: string | UserContent[]): this;

  /** Add an assistant message */
  assistant(content: string | AssistantContent[]): this;

  /** Filter messages by type */
  filter(type: MessageType): Message[];

  /** Get last N messages */
  tail(count: number): Message[];

  /** Slice the thread */
  slice(start?: number, end?: number): Thread;

  /** Clear all messages */
  clear(): this;

  /** Export as Message array */
  toMessages(): Message[];

  /** Serialize to JSON */
  toJSON(): ThreadJSON;

  /** Deserialize from JSON */
  static fromJSON(json: ThreadJSON): Thread;
}
```

## Basic Usage

```typescript
import { Thread } from '@providerprotocol/ai';

const thread = new Thread();

// Use with llm()
const turn1 = await claude.generate(thread, 'Hello!');
thread.append(turn1);

const turn2 = await claude.generate(thread, 'What did I just say?');
thread.append(turn2);

console.log(turn2.response.text); // References "Hello!"
```

## Building Threads Manually

```typescript
const thread = new Thread();

// Add messages fluently
thread
  .user('What is TypeScript?')
  .assistant('TypeScript is a typed superset of JavaScript...');

// Use as context
const turn = await claude.generate(thread, 'Give me an example');
```

## Filtering and Slicing

```typescript
// Get only user messages
const userMessages = thread.filter('user');

// Get last 10 messages
const recent = thread.tail(10);

// Create a subset
const slice = thread.slice(-5); // Last 5 messages as new Thread
```

## Serialization

```typescript
// Save to JSON
const json = thread.toJSON();
await Bun.write('conversation.json', JSON.stringify(json));

// Load from JSON
const loaded = await Bun.file('conversation.json').json();
const restored = Thread.fromJSON(loaded);
```

## Related

- [llm()](/api/core/llm)
- [Messages](/api/types/messages)
- [Turn](/api/types/turn)
